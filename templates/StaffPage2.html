<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SilverCare Nurse/Staff Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="{{ url_for('static', filename='css/StaffPage_style2.css') }}" rel="stylesheet"/>
</head>
<body>
  <!-- Top Navbar -->
  <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm sticky-top">
    <div class="container d-flex align-items-center">
      <a class="navbar-brand d-flex align-items-center me-3" href="{{ url_for('index') }}">
        <img src="{{ url_for('static', filename='images/SilverCare_Logo.jpg') }}" alt="SilverCare Logo" style="height:75px;margin-right:10px;">
      </a>

      <button id="sidebarToggle" class="btn btn-outline-secondary d-lg-none me-2" type="button" aria-label="Toggle sidebar" aria-expanded="false" aria-controls="appSidebar">
        <span class="navbar-toggler-icon"></span>
      </button>

      <form class="d-none d-lg-flex ms-3" role="search" onsubmit="event.preventDefault(); focusGlobalSearch();">
        <div class="input-group">
          <span class="input-group-text" aria-hidden="true">ðŸ”Ž</span>
          <input class="form-control" id="globalSearch" placeholder="Search residents, rooms, IDâ€¦ (Press /)" aria-label="Global search" />
        </div>
      </form>

      <div class="ms-auto d-flex align-items-center gap-2">
        <a class="btn btn-outline-danger" href="{{ url_for('logout') }}">Logout</a>
      </div>
    </div>
  </nav>

  <div class="page-shell d-flex">
    <!-- Sidebar -->
    <aside id="appSidebar" class="sidebar expanded" aria-label="Staff navigation">
      <div class="sidebar-top d-flex align-items-center px-3 py-3">
        <img src="../Images/SilverCare_Logo.jpg" alt="" class="sidebar-logo me-2" aria-hidden="true">
        <div class="sidebar-brand d-none d-lg-block">
          <strong>SilverCare</strong>
          <div class="small text-muted">Staff Portal</div>
        </div>
      </div>

      <nav class="sidebar-nav px-2" role="navigation">
        <ul class="nav flex-column">
          <li class="nav-item">
            <a class="nav-link d-flex align-items-center active" href="#home" data-bs-toggle="pill" role="tab" aria-controls="home" aria-current="page">
              <span class="sidebar-text">Overview</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link d-flex align-items-center" href="#residents" data-bs-toggle="pill" role="tab" aria-controls="residents">
              <span class="sidebar-text">Residents</span>
            </a>
          </li>
            <li class="nav-item">
              <a class="nav-link d-flex align-items-center" href="#profile" data-bs-toggle="pill" role="tab" aria-controls="profile">
                <span class="sidebar-text">My Profile</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link d-flex align-items-center" href="#appointments" data-bs-toggle="pill" role="tab" aria-controls="appointments">
                <span class="sidebar-text">Appointments</span>
              </a>
            </li>
        </ul>
      </nav>

      <div class="sidebar-footer mt-auto px-2 py-3 text-center">
        <div class="small text-muted">Signed in as <strong>Nurse</strong></div>
      </div>
    </aside>

    <!-- Main content -->
    <main class="flex-grow-1 p-4">

      <div class="container">
        <div class="row">
          <!-- Left Main Content -->
          <div class="col-lg-9">
            <div class="tab-content">
              <!-- Overview -->
              <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="tab-home">
                <section class="container welcome-banner mb-4">
                  <div class="d-flex align-items-center gap-3">
                    <img src="{{ url_for('static', filename='images/SilverCare_Logo.jpg') }}" alt="Profile Picture" class="profile-avatar" />
                    <div class="flex-grow-1">
                      <h1 class="m-0">{{ (staff.first_name ~ ' ' ~ staff.last_name) if staff else session.get('email','Staff Member') }}</h1>
                      <p class="m-0">
                        Shift: <strong>Day (07:00â€“15:00)</strong> â€¢ Unit: <strong>North â€“ 2</strong> â€¢
                        <span class="chip green"><span class="status-dot status-green"></span> On Duty</span>
                      </p>
                      <p class="mt-1 small text-white-50">Email: {{ staff.email if staff else session.get('email','') }}</p>
                    </div>
                  </div>
                </section>
                <div class="section-card">
                  <h2 class="mb-3">Overview</h2>
                  <div class="d-flex flex-wrap gap-3 align-items-center">
                    <div class="fw-semibold">Total Residents: <span id="totalResidents">{{ total_patients_count }}</span></div>
                  </div>
                  <hr class="my-3" />
                  <h6 class="text-muted mb-2">Residents With Appointments</h6>
                  <ul id="staffApptResidentsList" class="mb-0 small"><!-- populated by JS --></ul>
                </div>
              </div>

              <!-- Residents -->
              <div class="tab-pane fade" id="residents" role="tabpanel" aria-labelledby="tab-residents">
                <section class="container welcome-banner mb-4">
                  <div class="d-flex align-items-center gap-3">
                    <img src="{{ url_for('static', filename='images/SilverCare_Logo.jpg') }}" alt="Profile Picture" class="profile-avatar" />
                    <div class="flex-grow-1">
                      <h1 class="m-0">{{ (staff.first_name ~ ' ' ~ staff.last_name) if staff else session.get('email','Staff Member') }}</h1>
                      <p class="m-0">
                        Shift: <strong>Day (07:00â€“15:00)</strong> â€¢ Unit: <strong>North â€“ 2</strong> â€¢
                        <span class="chip green"><span class="status-dot status-green"></span> On Duty</span>
                      </p>
                      <p class="mt-1 small text-white-50">Email: {{ staff.email if staff else session.get('email','') }}</p>
                    </div>
                  </div>
                </section>
                <div class="section-card">
                  <div class="d-flex align-items-center justify-content-between mb-3">
                    <h2 class="m-0">Residents</h2>
                    <a href="{{ url_for('create_patient') }}" class="btn btn-primary">ï¼‹ Add New Resident</a>
                  </div>

                  <div class="row g-3 align-items-end">
                    <div class="col-md-4">
                      <label class="form-label">Search residents</label>
                      <input type="text" class="form-control" id="resSearch" placeholder="Name, age, last added.." />
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">Sort by name</label>
                      <select class="form-select" id="resSortName">
                        <option value="">No name sort</option>
                        <option value="name-asc">A->Z</option>
                        <option value="name-desc">Z->A</option>
                      </select>
                    </div>

                    <div class="col-md-3">
                      <label class="form-label">Sort by added Date</label>
                      <select class="form-select" id="resSortAdded">
                        <option value="">No date sort</option>
                        <option value="created-desc">Most recent patient</option>
                        <option value="created-asc">Oldest patient</option>
                      </select>
                    </div>

                    <div class="col-md-2">
                      <button type="button" class="btn btn-primary w-100" onclick="filterResidents()">Filter</button>
                    </div>
                  </div>

                  <div class="table-responsive mt-3">
                    <table class="table align-middle" id="resTable">
                      <thead>
                        <tr>
                          <th>Last Name</th>
                          <th>First Name</th>
                          <th>PHN</th>
                          <th>Actions</th>
                        </tr>
                      </thead>
                      <tbody><!-- injected by JS --></tbody>
                    </table>
                  </div>
                </div>

                <div class="section-card">
                  <h5>Audit Trail (last actions)</h5>
                  <ul id="auditList" class="mb-0 small"></ul>
                </div>
              </div>

              <!-- Appointments -->
              <div class="tab-pane fade" id="appointments" role="tabpanel" aria-labelledby="tab-appointments">
                <section class="container welcome-banner mb-4">
                  <div class="d-flex align-items-center gap-3">
                    <img src="{{ url_for('static', filename='images/SilverCare_Logo.jpg') }}" alt="Profile Picture" class="profile-avatar" />
                    <div class="flex-grow-1">
                      <h1 class="m-0">{{ (staff.first_name ~ ' ' ~ staff.last_name) if staff else session.get('email','Staff Member') }}</h1>
                      <p class="m-0">
                        Shift: <strong>Day (07:00â€“15:00)</strong> â€¢ Unit: <strong>North â€“ 2</strong> â€¢
                        <span class="chip green"><span class="status-dot status-green"></span> On Duty</span>
                      </p>
                      <p class="mt-1 small text-white-50">Email: {{ staff.email if staff else session.get('email','') }}</p>
                    </div>
                  </div>
                </section>
                <div class="section-card">
                  <div class="d-flex flex-wrap gap-2 align-items-end">
                    <div>
                      <label class="form-label">View</label>
                      <select class="form-select" id="apptView" style="min-width:160px;">
                        <option value="day">Day</option>
                        <option value="week">Week</option>
                      </select>
                    </div>
                    <div>
                      <label class="form-label">Date</label>
                      <input type="date" class="form-control" id="apptDate">
                    </div>
                    <button class="btn btn-primary ms-auto" onclick="openAddAppt()">ï¼‹ Add appointment</button>
                    <button class="btn btn-outline-secondary" onclick="sendReminders()">Send reminders</button>
                  </div>

                  <div id="apptList" class="mt-3"><!-- injected --></div>
                </div>
              </div>

              <!-- Tasks -->
              <div class="tab-pane fade" id="tasks" role="tabpanel" aria-labelledby="tab-tasks">
                <div class="section-card">
                  <div class="d-flex align-items-center justify-content-between">
                    <h2 class="m-0">Tasks & Rounds</h2>
                    <button class="btn btn-primary" onclick="addTaskPrompt()">ï¼‹ New Task</button>
                  </div>
                  <div id="taskList" class="mt-2"><!-- injected --></div>
                  <div class="d-flex gap-2 mt-3">
                    <button class="btn btn-success" onclick="completeSelected()">Mark selected done</button>
                    <button class="btn btn-outline-secondary" onclick="clearCompleted()">Clear completed</button>
                  </div>
                </div>
              </div>

              <!-- Messages & Handover -->
              <div class="tab-pane fade" id="messages" role="tabpanel" aria-labelledby="tab-messages">
                <div class="section-card">
                  <h2>Secure Messages</h2>
                  <div id="msgThread" class="mb-3" aria-live="polite">
                    <div class="msg"><strong>Alice (Charge):</strong> Reminder: Vaccination clinic tomorrow 10:00â€“12:00 in Rec Room.</div>
                    <div class="msg me"><strong>You:</strong> Roger. Iâ€™ll prep consent forms for North-2.</div>
                  </div>
                  <div class="input-group">
                    <input id="msgInput" class="form-control" placeholder="Type a message (Enter to send)" />
                    <button class="btn btn-primary" onclick="sendMsg()">Send</button>
                  </div>
                </div>

                <div class="section-card">
                  <h2>Shift Handover (SBAR)</h2>
                  <div class="row g-3">
                    <div class="col-md-6">
                      <label class="form-label">Situation</label>
                      <textarea id="sbarS" class="form-control" rows="2" placeholder="Who, where, main concernâ€¦"></textarea>
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">Background</label>
                      <textarea id="sbarB" class="form-control" rows="2" placeholder="Dx, relevant history, allergiesâ€¦"></textarea>
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">Assessment</label>
                      <textarea id="sbarA" class="form-control" rows="2" placeholder="Vitals, pain, mobility, labsâ€¦"></textarea>
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">Recommendation</label>
                      <textarea id="sbarR" class="form-control" rows="2" placeholder="Tests, consults, next stepsâ€¦"></textarea>
                    </div>
                  </div>
                  <div class="mt-3 d-flex gap-2">
                    <button class="btn btn-primary" onclick="saveSBAR()">Save draft</button>
                    <button class="btn btn-outline-secondary" onclick="clearSBAR()">Clear</button>
                    <button class="btn btn-outline-primary" onclick="readAloudSBAR()">ðŸ”Š Read aloud</button>
                  </div>
                  <div id="sbarStatus" class="small text-muted mt-2"></div>
                </div>
              </div>

              <!-- Reports -->
              <div class="tab-pane fade" id="reports" role="tabpanel" aria-labelledby="tab-reports">
                <div class="section-card">
                  <h2>Reports (Example)</h2>
                  <div class="row g-3">
                    <div class="col-md-4">
                      <div class="section-card text-center">
                        <div class="display-6">92%</div>
                        <div class="text-muted">Appt attendance (week)</div>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="section-card text-center">
                        <div class="display-6">6</div>
                        <div class="text-muted">No-shows (month)</div>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="section-card text-center">
                        <div class="display-6">14</div>
                        <div class="text-muted">Incidents logged (month)</div>
                      </div>
                    </div>
                  </div>
                  <p class="mb-0 small text-muted">These are example metrics. You can hook API results here later.</p>
                </div>
              </div>

              <!-- Admin -->
              <div class="tab-pane fade" id="admin" role="tabpanel" aria-labelledby="tab-admin">
                <div class="section-card">
                  <h2>Admin & Data Tools</h2>
                  <div class="row g-3">
                    <div class="col-md-6">
                      <div class="section-card">
                        <h5>User & role management</h5>
                        <p class="mb-2 small text-muted">Least-privilege access; re-auth required for MAR sign-offs.</p>
                        <div class="input-group">
                          <span class="input-group-text">Role</span>
                          <select class="form-select">
                            <option>Nurse</option>
                            <option>Charge Nurse</option>
                            <option>Admin</option>
                          </select>
                        </div>
                        <button class="btn btn-outline-primary btn-sm mt-2" onclick="toast('Roles updated (demo)')">Save</button>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="section-card">
                        <h5>Data import/export</h5>
                        <div class="d-flex gap-2">
                          <button class="btn btn-outline-secondary btn-sm" onclick="toast('Import residents.csv (demo)')">Import CSV</button>
                          <button class="btn btn-outline-secondary btn-sm" onclick="toast('Export appointments.csv (demo)')">Export CSV</button>
                        </div>
                        <p class="small text-muted mt-2 mb-0">Audit logging enabled. PII minimized in exports.</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!-- end Admin -->
            </div>
          </div>

          <!-- Right Tools Rail -->
          <div class="col-lg-3">
            <div class="sticky-tools">
              <div class="section-card">
                <h5 class="mb-2">Emergency</h5>
                <button class="btn btn-danger w-100 btn-large mb-2" onclick="toast('Emergency alert sent to all staff!')">ðŸš¨ Send alert</button>
                <button class="btn btn-outline-danger w-100" onclick="speak('Emergency alert sent to all staff!')">ðŸ”Š Announce</button>
              </div>

              <div class="section-card">
                <h5 class="mb-2">Help & Support</h5>
                <p class="small mb-2">Call <a href="tel:+16041234567">(604) 123-4567</a><br>or see the onboarding guide.</p>
                <button class="btn btn-outline-secondary w-100" onclick="showHelp()">Open help</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Resident Profile Modal -->
      <div class="modal fade" id="residentModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="residentTitle">Resident</h5>
              <button class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <div id="residentBody"><!-- injected --></div>
            </div>
            <div class="modal-footer">
              <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
              <button class="btn btn-primary" onclick="toast('Saved (demo)')">Save changes</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Add Appointment Modal -->
      <div class="modal fade" id="addApptModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Add appointment</h5>
              <button class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <div class="mb-2">
                <label class="form-label">Resident</label>
                <select class="form-select" id="apptResident"></select>
              </div>
              <div class="mb-2">
                <label class="form-label">Type</label>
                <select class="form-select" id="apptType">
                  <option>Checkup</option>
                  <option>Cardiology</option>
                  <option>Physiotherapy</option>
                  <option>Lab</option>
                </select>
              </div>
              <div class="row g-2">
                <div class="col-7">
                  <label class="form-label">Date</label>
                  <input type="date" class="form-control" id="apptNewDate">
                </div>
                <div class="col-5">
                  <label class="form-label">Time</label>
                  <input type="time" class="form-control" id="apptNewTime" />
                </div>
              </div>
              <div class="mt-2">
                <label class="form-label">Notes</label>
                <textarea class="form-control" id="apptNotes" rows="2" placeholder="Prep instructions, escortsâ€¦"></textarea>
              </div>
            </div>
            <div class="modal-footer">
              <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
              <button class="btn btn-primary" onclick="saveAppointment()">Save</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Vitals Modal (ported from legacy dashboard) -->
      <div class="modal fade" id="vitalsModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Edit Vitals for <span id="vitalsPatientName"></span></h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <form id="vitalsForm">
                <input type="hidden" id="vitalsPatientId" name="patient_id">
                <div class="row g-2">
                  <div class="col-md-4">
                    <label class="form-label">Blood Pressure (mmHg)</label>
                    <input type="text" class="form-control" name="blood_pressure">
                  </div>
                  <div class="col-md-4">
                    <label class="form-label">BMI</label>
                    <input type="number" step="0.1" class="form-control" name="bmi">
                  </div>
                  <div class="col-md-4">
                    <label class="form-label">Weight (kg)</label>
                    <input type="number" step="0.1" class="form-control" name="weight">
                  </div>
                  <div class="col-md-4">
                    <label class="form-label">Height (cm)</label>
                    <input type="number" class="form-control" name="height">
                  </div>
                  <div class="col-md-4">
                    <label class="form-label">Respiratory Rate (breaths/min)</label>
                    <input type="number" class="form-control" name="respiratory_rate">
                  </div>
                  <div class="col-md-4">
                    <label class="form-label">Temperature (Â°C)</label>
                    <input type="number" step="0.1" class="form-control" name="temperature">
                  </div>
                  <div class="col-md-4">
                    <label class="form-label">Heart Rate (bpm)</label>
                    <input type="number" class="form-control" name="heart_rate">
                  </div>
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
              <button type="button" class="btn btn-primary" onclick="submitVitals()">ðŸ’¾ Save</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Toasts -->
      <div class="toast-container" id="toastCtn"></div>
    </main>
  </div>

  <!-- Bootstrap -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="{{ url_for('static', filename='js/StaffPage_2.js') }}" defer></script>
</body>
</html>
