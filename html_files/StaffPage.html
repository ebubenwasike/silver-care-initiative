<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SilverCare Nurse/Staff Dashboard</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="../css_files/StaffPage_style.css" rel="stylesheet"/>
  <script src="../javascript_files/StaffPage.js" defer></script>
  <style>
  </style>
</head>
<body>
  <!-- Top Navbar -->
  <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm sticky-top">
    <div class="container d-flex align-items-center">
      <a class="navbar-brand d-flex align-items-center me-3" href="index.html">
        <img src="../Images/SilverCare_Logo.jpg" alt="SilverCare Logo" style="height: 75px; margin-right: 10px;">
      </a>

      <hr class="my-2 text-secondary" style="opacity: 0.2;">


      <!-- Sidebar toggle (visible on all sizes) -->
      <button id="sidebarToggle" class="btn btn-light border ms-auto ms-lg-0 me-2" aria-label="Toggle sidebar">
        <span class="navbar-toggler-icon"></span>
      </button>

      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#topNav">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="topNav">
        <form class="d-none d-lg-flex ms-3" role="search" onsubmit="event.preventDefault(); focusGlobalSearch();">
          <div class="input-group">
            <span class="input-group-text">üîé</span>
            <input class="form-control" id="globalSearch" placeholder="Search residents, rooms, ID‚Ä¶  (Press / )" />
          </div>
        </form>

        <div class="ms-auto d-flex align-items-center gap-2">
          <button class="btn btn-outline-primary" id="btn-quickAdd" title="Quick Create (Shift + N)">Ôºã New</button>
          <button class="btn btn-outline-secondary" id="btn-help">Help</button>
          <a class="btn btn-outline-danger" href="login.html">Logout</a>
        </div>
      </div>
    </div>
  </nav>

  <div class="page-shell d-flex">
    <!-- Sidebar -->
    <aside id="appSidebar" class="sidebar expanded" aria-label="Staff navigation">
      <div class="sidebar-top d-flex align-items-center px-3 py-3">
        <img src="../Images/SilverCare_Logo.jpg" alt="logo" class="sidebar-logo me-2">
        <div class="sidebar-brand d-none d-lg-block">
          <strong>SilverCare</strong><div class="small text-muted">Staff Portal</div>
        </div>
      </div>

      <nav class="sidebar-nav px-2" role="navigation">
        <ul class="nav flex-column">
          <li class="nav-item">
            <a class="nav-link d-flex align-items-center active" href="#overview" data-bs-toggle="pill">
              <span class="sidebar-icon">üè†</span>
              <span class="sidebar-text">Overview</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link d-flex align-items-center" href="#residents" data-bs-toggle="pill" role="tab" aria-controls="residents">
              <span class="sidebar-icon">üßë‚Äçü¶≥</span>
              <span class="sidebar-text">Residents</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link d-flex align-items-center" href="#tasks" data-bs-toggle="pill">
              <span class="sidebar-icon">üìù</span>
              <span class="sidebar-text">Tasks & Rounds</span>
            </a>
          </li>
          <!-- add other items as needed -->
        </ul>
      </nav>

      <div class="sidebar-footer mt-auto px-2 py-3">
        <!-- Collapse button removed -->
        <div class="small text-muted text-center">Signed in as <strong>Nurse</strong></div>
      </div>
    </aside>

    <!-- Main content area -->
    <main class="flex-grow-1 p-4">
      <!-- Banner -->
      <section class="container welcome-banner">
        <div class="d-flex align-items-center gap-3">
          <div>
            <h1 class="m-0">Welcome back, Nurse Tommy</h1>
            <p class="m-0">Shift: <strong>Day (07:00‚Äì15:00)</strong> ‚Ä¢ Unit: <strong>North ‚Äì 2</strong> ‚Ä¢ <span class="chip green"><span class="status-dot status-green"></span> Systems normal</span></p>
            <p class="mt-2 small">Shortcuts: <kbd>/</kbd> search, <kbd>Shift</kbd> + <kbd>N</kbd> new note, <kbd>Shift</kbd> + <kbd>A</kbd> new appointment</p>
          </div>
        </div>
      </section>

      <!-- Main -->
      <div class="container">
        <div class="row">
            <!--Sidebar Navigation-->
            <nav class="col-lg-2 d-none d-lg-block sidebar-nav pt-3">
                <ul class="nav flex-column nav-pills" id="sidebar-tab" role="tablist">
                    <li class="nav-item mb-2" role="presentation">
                        <button class="nav-link active w-100" id="tab-home" data-bs-toggle="pill" data-bs-target="#home" type="button" role="tab">Overview</button>
                    </li>
                    <li class="nav-item mb-2" role="presentation">
                        <button class="nav-link w-100" id="tab-residents" data-bs-toggle="pill" data-bs-target="#residents" type="button" role="tab">Residents</button>
                    </li>
                    <li class="nav-item mb-2" role="presentation">
                        <button class="nav-link w-100" id="tab-appointments" data-bs-toggle="pill" data-bs-target="#appointments" type="button" role="tab">Appointments</button>
                    </li>
                    <li class="nav-item mb-2" role="presentation">
                        <button class="nav-link w-100" id="tab-tasks" data-bs-toggle="pill" data-bs-target="#tasks" type="button" role="tab">Tasks & Rounds</button>
                    </li>
                    <li class="nav-item mb-2" role="presentation">
                        <button class="nav-link w-100" id="tab-messages" data-bs-toggle="pill" data-bs-target="#messages" type="button" role="tab">Messaging & Handover</button>
                    </li>
                    <li class="nav-item mb-2" role="presentation">
                        <button class="nav-link w-100" id="tab-reports" data-bs-toggle="pill" data-bs-target="#reports" type="button" role="tab">Reports</button>
                    </li>
                    <li class="nav-item mb-2" role="presentation">
                        <button class="nav-link w-100" id="tab-admin" data-bs-toggle="pill" data-bs-target="#admin" type="button" role="tab">Admin</button>
                    </li>


                </ul>
            </nav>

          <!-- Left Main Content -->
          <div class="col-lg-9">
                 <div class="tab-content">
              <!-- Overview -->
              <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="tab-home">
                <div class="section-card">
                  <h2>Today‚Äôs Overview</h2>
                  <div class="row g-3">
                    <div class="col-md-4">
                      <div class="section-card">
                        <div class="d-flex justify-content-between align-items-center">
                          <span>Assigned residents</span><span class="badge bg-primary">12</span>
                        </div>
                        <ul class="mt-2 mb-0">
                          <li>101A ‚Äî Jane Doe <span class="chip green">Stable</span></li>
                          <li>102B ‚Äî Robert White <span class="chip amber">Needs Review</span></li>
                          <li>103C ‚Äî Mary Lee <span class="chip green">Stable</span></li>
                        </ul>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="section-card">
                        <div class="d-flex justify-content-between align-items-center">
                          <span>Upcoming appts (72h)</span><span class="badge bg-info text-dark">5</span>
                        </div>
                        <ul class="mt-2 mb-0">
                          <li>Jane ‚Äî Oct 14 ‚Ä¢ PT</li>
                          <li>Robert ‚Äî Oct 14 ‚Ä¢ Cardio</li>
                          <li>Mary ‚Äî Oct 15 ‚Ä¢ Lab</li>
                        </ul>
                        <button class="btn btn-outline-primary btn-sm mt-2" onclick="openAddAppt()">Add appointment</button>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="section-card">
                        <div class="d-flex justify-content-between align-items-center">
                          <span>Critical alerts</span><span class="badge bg-danger">2</span>
                        </div>
                        <ul class="mt-2 mb-0">
                          <li>Robert ‚Äî BP trend high</li>
                          <li>Mary ‚Äî Fall risk ‚Üë</li>
                        </ul>
                        <button class="btn btn-outline-danger btn-sm mt-2" onclick="ackAlerts()">Acknowledge</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Residents -->
              <div class="tab-pane fade" id="residents" role="tabpanel" aria-labelledby="tab-residents">
                <div class="section-card">
                  <div class="row g-3 align-items-end">
                    <div class="col-md-4">
                      <label class="form-label">Search residents</label>
                      <input class="form-control" id="resSearch" placeholder="Name, room, ID‚Ä¶" />
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">Status</label>
                      <select class="form-select" id="resStatus">
                        <option value="">All</option>
                        <option>Stable</option>
                        <option>Needs Review</option>
                        <option>Critical</option>
                      </select>
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">Unit</label>
                      <select class="form-select" id="resUnit">
                        <option value="">Any</option>
                        <option>North-2</option>
                        <option>East-1</option>
                      </select>
                    </div>
                    <div class="col-md-2">
                      <button class="btn btn-primary w-100" onclick="filterResidents()">Filter</button>
                    </div>
                  </div>

                  <div class="table-responsive mt-3">
                    <table class="table align-middle" id="resTable">
                      <thead>
                        <tr>
                          <th>Resident</th>
                          <th>Room</th>
                          <th>Status</th>
                          <th>Allergies</th>
                          <th>Last Updated</th>
                          <th></th>
                        </tr>
                      </thead>
                      <tbody><!-- injected by JS --></tbody>
                    </table>
                  </div>
                </div>

                <div class="section-card">
                  <h5>Audit Trail (last actions)</h5>
                  <ul id="auditList" class="mb-0 small"></ul>
                </div>
              </div>

              <!-- Appointments -->
              <div class="tab-pane fade" id="appointments" role="tabpanel" aria-labelledby="tab-appointments">
                <div class="section-card">
                  <div class="d-flex flex-wrap gap-2 align-items-end">
                    <div>
                      <label class="form-label">View</label>
                      <select class="form-select" id="apptView" style="min-width: 160px;">
                        <option value="day">Day</option>
                        <option value="week">Week</option>
                      </select>
                    </div>
                    <div>
                      <label class="form-label">Date</label>
                      <input type="date" class="form-control" id="apptDate">
                    </div>
                    <button class="btn btn-primary ms-auto" onclick="openAddAppt()">Ôºã Add appointment</button>
                    <button class="btn btn-outline-secondary" onclick="sendReminders()">Send reminders</button>
                  </div>

                  <div id="apptList" class="mt-3"><!-- injected --></div>
                </div>
              </div>

              <!-- Tasks -->
              <div class="tab-pane fade" id="tasks" role="tabpanel" aria-labelledby="tab-tasks">
                <div class="section-card">
                  <div class="d-flex align-items-center justify-content-between">
                    <h2 class="m-0">Tasks & Rounds</h2>
                    <button class="btn btn-primary" onclick="addTaskPrompt()">Ôºã New Task</button>
                  </div>
                  <div id="taskList" class="mt-2"><!-- injected --></div>
                  <div class="d-flex gap-2 mt-3">
                    <button class="btn btn-success" onclick="completeSelected()">Mark selected done</button>
                    <button class="btn btn-outline-secondary" onclick="clearCompleted()">Clear completed</button>
                  </div>
                </div>
              </div>

              <!-- Messages & Handover -->
              <div class="tab-pane fade" id="messages" role="tabpanel" aria-labelledby="tab-messages">
                <div class="section-card">
                  <h2>Secure Messages</h2>
                  <div id="msgThread" class="mb-3" aria-live="polite">
                    <div class="msg"><strong>Alice (Charge):</strong> Reminder: Vaccination clinic tomorrow 10:00‚Äì12:00 in Rec Room.</div>
                    <div class="msg me"><strong>You:</strong> Roger. I‚Äôll prep consent forms for North-2.</div>
                  </div>
                  <div class="input-group">
                    <input id="msgInput" class="form-control" placeholder="Type a message (Enter to send)" />
                    <button class="btn btn-primary" onclick="sendMsg()">Send</button>
                  </div>
                </div>

                <div class="section-card">
                  <h2>Shift Handover (SBAR)</h2>
                  <div class="row g-3">
                    <div class="col-md-6">
                      <label class="form-label">Situation</label>
                      <textarea id="sbarS" class="form-control" rows="2" placeholder="Who, where, main concern‚Ä¶"></textarea>
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">Background</label>
                      <textarea id="sbarB" class="form-control" rows="2" placeholder="Dx, relevant history, allergies‚Ä¶"></textarea>
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">Assessment</label>
                      <textarea id="sbarA" class="form-control" rows="2" placeholder="Vitals, pain, mobility, labs‚Ä¶"></textarea>
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">Recommendation</label>
                      <textarea id="sbarR" class="form-control" rows="2" placeholder="Tests, consults, next steps‚Ä¶"></textarea>
                    </div>
                  </div>
                  <div class="mt-3 d-flex gap-2">
                    <button class="btn btn-primary" onclick="saveSBAR()">Save draft</button>
                    <button class="btn btn-outline-secondary" onclick="clearSBAR()">Clear</button>
                    <button class="btn btn-outline-primary" onclick="readAloudSBAR()">üîä Read aloud</button>
                  </div>
                  <div id="sbarStatus" class="small text-muted mt-2"></div>
                </div>
              </div>

              <!-- Reports -->
              <div class="tab-pane fade" id="reports" role="tabpanel" aria-labelledby="tab-reports">
                <div class="section-card">
                  <h2>Reports (Example)</h2>
                  <div class="row g-3">
                    <div class="col-md-4">
                      <div class="section-card text-center">
                        <div class="display-6">92%</div>
                        <div class="text-muted">Appt attendance (week)</div>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="section-card text-center">
                        <div class="display-6">6</div>
                        <div class="text-muted">No-shows (month)</div>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="section-card text-center">
                        <div class="display-6">14</div>
                        <div class="text-muted">Incidents logged (month)</div>
                      </div>
                    </div>
                  </div>
                  <p class="mb-0 small text-muted">These are example metrics. You can hook API results here later.</p>
                </div>
              </div>

              <!-- Admin -->
              <div class="tab-pane fade" id="admin" role="tabpanel" aria-labelledby="tab-admin">
                <div class="section-card">
                  <h2>Admin & Data Tools</h2>
                  <div class="row g-3">
                    <div class="col-md-6">
                      <div class="section-card">
                        <h5>User & role management</h5>
                        <p class="mb-2 small text-muted">Least-privilege access; re-auth required for MAR sign-offs.</p>
                        <div class="input-group">
                          <span class="input-group-text">Role</span>
                          <select class="form-select">
                            <option>Nurse</option>
                            <option>Charge Nurse</option>
                            <option>Admin</option>
                          </select>
                        </div>
                        <button class="btn btn-outline-primary btn-sm mt-2" onclick="toast('Roles updated (demo)')">Save</button>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="section-card">
                        <h5>Data import/export</h5>
                        <div class="d-flex gap-2">
                          <button class="btn btn-outline-secondary btn-sm" onclick="toast('Import residents.csv (demo)')">Import CSV</button>
                          <button class="btn btn-outline-secondary btn-sm" onclick="toast('Export appointments.csv (demo)')">Export CSV</button>
                        </div>
                        <p class="small text-muted mt-2 mb-0">Audit logging enabled. PII minimized in exports.</p>
                      </div>
                    </div>
                  </div>
                </div>

              </div><!-- end Admin -->
            </div><!-- end tab-content -->
          </div>

          <!-- Right Tools Rail -->
          <div class="col-lg-3">
            <div class="sticky-tools">
              <div class="section-card">
                <h5 class="mb-2">Quick Actions</h5>
                <div class="d-grid gap-2">
                  <button class="btn btn-primary btn-large" onclick="openAddAppt()">Ôºã Add appointment</button>
                  <button class="btn btn-outline-primary btn-large" onclick="addTaskPrompt()">Ôºã Add task</button>
                  <button class="btn btn-outline-secondary btn-large" onclick="openNewNote()">Ôºã New note</button>
                </div>
              </div>

              <div class="section-card">
                <h5 class="mb-2">Emergency</h5>
                <button class="btn btn-danger w-100 btn-large mb-2" onclick="toast('Emergency alert sent to all staff!')">üö® Send alert</button>
                <button class="btn btn-outline-danger w-100" onclick="speak('Emergency alert sent to all staff!')">üîä Announce</button>
              </div>

              <div class="section-card">
                <h5 class="mb-2">Help & Support</h5>
                <p class="small mb-2">Call <a href="tel:+16041234567">(604) 123-4567</a><br/>or see the onboarding guide.</p>
                <button class="btn btn-outline-secondary w-100" onclick="showHelp()">Open help</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Resident Profile Modal -->
      <div class="modal fade" id="residentModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="residentTitle">Resident</h5>
              <button class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <div id="residentBody"><!-- injected --></div>
            </div>
            <div class="modal-footer">
              <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
              <button class="btn btn-primary" onclick="toast('Saved (demo)')">Save changes</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Add Appointment Modal -->
      <div class="modal fade" id="addApptModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Add appointment</h5>
              <button class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <div class="mb-2">
                <label class="form-label">Resident</label>
                <select class="form-select" id="apptResident"></select>
              </div>
              <div class="mb-2">
                <label class="form-label">Type</label>
                <select class="form-select" id="apptType">
                  <option>Checkup</option>
                  <option>Cardiology</option>
                  <option>Physiotherapy</option>
                  <option>Lab</option>
                </select>
              </div>
              <div class="row g-2">
                <div class="col-7">
                  <label class="form-label">Date</label>
                  <input type="date" class="form-control" id="apptNewDate">
                </div>
                <div class="col-5">
                  <label class="form-label">Time</label>
                  <input type="time" class="form-control" id="apptNewTime" />
                </div>
              </div>
              <div class="mt-2">
                <label class="form-label">Notes</label>
                <textarea class="form-control" id="apptNotes" rows="2" placeholder="Prep instructions, escorts‚Ä¶"></textarea>
              </div>
            </div>
            <div class="modal-footer">
              <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
              <button class="btn btn-primary" onclick="saveAppointment()">Save</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Toasts -->
      <div class="toast-container" id="toastCtn"></div>

      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
      <script>
        // ---------- Mock Data ----------
        const RESIDENTS = [
          { id:'R101', name:'Jane Doe', room:'101A', status:'Stable', unit:'North-2', allergies:'Penicillin', last:'10:30', bp:'118/78', hr:72, temp:36.9, risks:['Allergy'], code:'Full', contact:'Daughter: 604-555-1234' },
          { id:'R102', name:'Robert White', room:'102B', status:'Needs Review', unit:'North-2', allergies:'NKDA', last:'09:50', bp:'140/90', hr:85, temp:37.5, risks:['Fall risk'], code:'DNR', contact:'Son: 604-555-5678' },
          { id:'R103', name:'Mary Lee', room:'103C', status:'Stable', unit:'East-1', allergies:'Latex', last:'11:00', bp:'125/82', hr:76, temp:37.0, risks:['Fall risk','Allergy'], code:'Full', contact:'Niece: 604-555-0000' },
        ];
        let APPOINTMENTS = [
          { id:'A1', resident:'Jane Doe', type:'PT', date:todayISO(), time:'10:30', status:'Scheduled' },
          { id:'A2', resident:'Robert White', type:'Cardiology', date:addDaysISO(1), time:'14:00', status:'Scheduled' },
          { id:'A3', resident:'Mary Lee', type:'Lab', date:addDaysISO(2), time:'09:15', status:'Scheduled' },
        ];

        // ---------- Utilities ----------
        function todayISO(){ const d = new Date(); d.setHours(0,0,0,0); return d.toISOString().split('T')[0]; }
        function addDaysISO(n){ const d = new Date(); d.setDate(d.getDate()+n); d.setHours(0,0,0,0); return d.toISOString().split('T')[0]; }
        function speak(text){ if('speechSynthesis' in window){ const u=new SpeechSynthesisUtterance(text); u.rate=.9; speechSynthesis.cancel(); speechSynthesis.speak(u);} }
        function toast(msg, variant='primary'){ const id='t'+Math.random().toString(36).slice(2); const el=document.createElement('div'); el.className=`toast align-items-center text-bg-${variant}`; el.id=id; el.setAttribute('role','status'); el.setAttribute('aria-live','polite'); el.innerHTML=`<div class="d-flex"><div class="toast-body">${msg}</div><button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button></div>`; document.getElementById('toastCtn').appendChild(el); new bootstrap.Toast(el,{delay:2500}).show(); }

        // ---------- Global Search ----------
        function focusGlobalSearch(){ document.getElementById('globalSearch').focus(); }
        document.addEventListener('keydown', (e)=> {
          if(e.key === '/' && !['INPUT','TEXTAREA'].includes(document.activeElement.tagName)){ e.preventDefault(); focusGlobalSearch(); }
          if(e.shiftKey && e.key.toLowerCase()==='n'){ e.preventDefault(); openNewNote(); }
          if(e.shiftKey && e.key.toLowerCase()==='a'){ e.preventDefault(); openAddAppt(); }
        });

        // ---------- Overview actions ----------
        function ackAlerts(){ toast('Alerts acknowledged', 'danger'); }

        // ---------- Residents: render & filter ----------
        function renderResidents(list=RESIDENTS){
          const tbody = document.querySelector('#resTable tbody');
          tbody.innerHTML = '';
          list.forEach(r=>{
            const badge = r.status==='Stable' ? '<span class="badge bg-success">Stable</span>'
                        : r.status==='Needs Review' ? '<span class="badge bg-warning text-dark">Needs Review</span>'
                        : '<span class="badge bg-danger">Critical</span>';
            const tr = document.createElement('tr');
            tr.innerHTML = `
              <td><strong>${r.name}</strong><div class="small text-muted">${r.id}</div></td>
              <td>${r.room}</td>
              <td>${badge}</td>
              <td>${r.allergies||'‚Äî'}</td>
              <td>${r.last}</td>
              <td class="text-end">
                <div class="btn-group">
                  <button class="btn btn-sm btn-outline-primary" onclick="openResident('${r.id}')">View</button>
                  <button class="btn btn-sm btn-outline-secondary" onclick="logAudit('Edited ${r.name} (demo)'); toast('Saved (demo)','secondary')">Save</button>
                </div>
              </td>`;
            tbody.appendChild(tr);
          });
        }
        function filterResidents(){
          const q = document.getElementById('resSearch').value.trim().toLowerCase();
          const s = document.getElementById('resStatus').value;
          const u = document.getElementById('resUnit').value;
          const filt = RESIDENTS.filter(r=>{
            const hit = (r.name.toLowerCase().includes(q) || r.room.toLowerCase().includes(q) || r.id.toLowerCase().includes(q));
            const statusOk = !s || r.status===s;
            const unitOk = !u || r.unit===u;
            return hit && statusOk && unitOk;
          });
          renderResidents(filt);
        }
        function openResident(id){
          const r = RESIDENTS.find(x=>x.id===id);
          if(!r) return;
          document.getElementById('residentTitle').textContent = `${r.name} ‚Äî ${r.room}`;
          document.getElementById('residentBody').innerHTML = `
            <div class="row g-3">
              <div class="col-md-6">
                <div class="section-card">
                  <h6>Clinical snapshot</h6>
                  <div>BP: <strong>${r.bp}</strong> ‚Ä¢ HR: <strong>${r.hr}</strong> ‚Ä¢ Temp: <strong>${r.temp}¬∞C</strong></div>
                  <div>Risks: ${r.risks.map(x=>`<span class="chip ${x.toLowerCase().includes('fall')?'amber':'red'}">${x}</span>`).join(' ')}</div>
                  <div>Allergies: <strong>${r.allergies||'‚Äî'}</strong></div>
                  <div>Code status: <strong>${r.code}</strong></div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="section-card">
                  <h6>Contacts</h6>
                  <div>${r.contact}</div>
                  <h6 class="mt-3">Notes</h6>
                  <textarea class="form-control" rows="4" placeholder="Progress note‚Ä¶"></textarea>
                </div>
              </div>
              <div class="col-12">
                <div class="section-card">
                  <h6>Appointments</h6>
                  <ul class="mb-0">
                    ${APPOINTMENTS.filter(a=>a.resident===r.name).map(a=>`<li>${a.date} ‚Ä¢ ${a.time} ‚Ä¢ ${a.type} <span class="chip green">${a.status}</span></li>`).join('')}
                  </ul>
                </div>
              </div>
            </div>`;
          new bootstrap.Modal('#residentModal').show();
          logAudit(`Viewed ${r.name}`);
        }
        function logAudit(text){
          const li = document.createElement('li');
          li.textContent = `${new Date().toLocaleString()} ‚Äî ${text}`;
          document.getElementById('auditList').prepend(li);
        }

        // Initial render
        renderResidents();

        // ---------- Appointments ----------
        function renderAppts(){
          const view = document.getElementById('apptView').value;
          const date = document.getElementById('apptDate').value || todayISO();
          const list = document.getElementById('apptList');
          const base = new Date(date);
          let days = view==='day' ? 1 : 7;
          let html = '';
          for(let i=0;i<days;i++){
            const d = new Date(base); d.setDate(base.getDate()+i);
            const iso = d.toISOString().split('T')[0];
            const rows = APPOINTMENTS.filter(a=>a.date===iso).map(a=>`
              <tr>
                <td>${a.time}</td>
                <td><strong>${a.resident}</strong></td>
                <td>${a.type}</td>
                <td><span class="chip ${a.status==='Scheduled'?'green':'amber'}">${a.status}</span></td>
                <td class="text-end">
                  <button class="btn btn-sm btn-outline-secondary" onclick="toast('Rescheduled (demo)')">Reschedule</button>
                  <button class="btn btn-sm btn-outline-danger" onclick="toast('Cancelled (demo)','danger')">Cancel</button>
                </td>
              </tr>`).join('');
            html += `
              <div class="section-card">
                <h5 class="mb-2">${d.toLocaleDateString()}</h5>
                <div class="table-responsive">
                  <table class="table table-sm align-middle">
                    <thead><tr><th>Time</th><th>Resident</th><th>Type</th><th>Status</th><th></th></tr></thead>
                    <tbody>${rows || '<tr><td colspan="5" class="text-muted">No appointments</td></tr>'}</tbody>
                  </table>
                </div>
              </div>`;
          }
          list.innerHTML = html;
        }
        document.getElementById('apptDate').value = todayISO();
        document.getElementById('apptView').addEventListener('change', renderAppts);
        document.getElementById('apptDate').addEventListener('change', renderAppts);
        renderAppts();

        function openAddAppt(){
          // populate residents
          const sel = document.getElementById('apptResident');
          sel.innerHTML = RESIDENTS.map(r=>`<option>${r.name}</option>`).join('');
          document.getElementById('apptNewDate').value = todayISO();
          document.getElementById('apptNewTime').value = '09:00';
          document.getElementById('apptNotes').value = '';
          new bootstrap.Modal('#addApptModal').show();
        }
        function saveAppointment(){
          const resident = document.getElementById('apptResident').value;
          const type = document.getElementById('apptType').value;
          const date = document.getElementById('apptNewDate').value;
          const time = document.getElementById('apptNewTime').value;
          APPOINTMENTS.push({ id:'A'+(APPOINTMENTS.length+1), resident, type, date, time, status:'Scheduled' });
          renderAppts();
          toast('Appointment saved (demo)');
          bootstrap.Modal.getInstance(document.getElementById('addApptModal')).hide();
          logAudit(`Added appt for ${resident} (${type}) ${date} ${time}`);
        }
        function sendReminders(){ toast('Reminders sent (demo)','secondary'); }

        // ---------- Tasks & Rounds (localStorage) ----------
        const TASKS_KEY = 'sc_tasks';
        function getTasks(){ try { return JSON.parse(localStorage.getItem(TASKS_KEY)||'[]'); } catch { return []; } }
        function saveTasks(t){ localStorage.setItem(TASKS_KEY, JSON.stringify(t)); }
        function renderTasks(){
          const t = getTasks();
          const list = document.getElementById('taskList');
          if(!t.length){ list.innerHTML = '<div class="text-muted">No tasks yet. Click ‚ÄúÔºã New Task‚Äù.</div>'; return; }
          list.innerHTML = t.map((x,i)=>`
            <div class="form-check d-flex align-items-start gap-2 py-1">
              <input class="form-check-input mt-1" type="checkbox" ${x.done?'checked':''} onchange="toggleTask(${i})">
              <div class="w-100">
                <div><strong>${x.title}</strong> ‚Äî <span class="text-muted">${x.resident||'Unassigned'}</span></div>
                <div class="small text-muted">Due: ${x.due||'‚Äî'} ‚Ä¢ Assigned: ${x.assignee||'‚Äî'} ‚Ä¢ Priority: ${x.priority||'Normal'}</div>
              </div>
              <button class="btn btn-sm btn-outline-danger" onclick="deleteTask(${i})">Delete</button>
            </div>`).join('');
        }
        function addTaskPrompt(){
          const title = prompt('Task title (e.g., Wound dressing 101A)');
          if(!title) return;
          const resident = prompt('Resident (optional)');
          const due = prompt('Due time (e.g., 14:00 or 2025-10-13 14:00)');
          const assignee = prompt('Assign to (e.g., Tommy)');
          const priority = prompt('Priority (Low/Normal/High)','Normal');
          const t = getTasks();
          t.push({ title, resident, due, assignee, priority, done:false });
          saveTasks(t); renderTasks(); toast('Task added');
        }
        function toggleTask(i){ const t=getTasks(); t[i].done=!t[i].done; saveTasks(t); renderTasks(); }
        function deleteTask(i){ const t=getTasks(); t.splice(i,1); saveTasks(t); renderTasks(); }
        function completeSelected(){ const t=getTasks().map(x=>({...x,done:true})); saveTasks(t); renderTasks(); toast('All tasks marked done','success'); }
        function clearCompleted(){ const t=getTasks().filter(x=>!x.done); saveTasks(t); renderTasks(); }

        renderTasks();

        // ---------- Messaging ----------
        function sendMsg(){
          const input = document.getElementById('msgInput');
          const val = input.value.trim();
          if(!val) return;
          const div = document.createElement('div');
          div.className = 'msg me';
          div.innerHTML = `<strong>You:</strong> ${val}`;
          document.getElementById('msgThread').appendChild(div);
          input.value='';
        }

        // ---------- SBAR ----------
        function saveSBAR(){
          const obj = { S: sbarS.value, B: sbarB.value, A: sbarA.value, R: sbarR.value, at: new Date().toISOString() };
          localStorage.setItem('sc_sbar', JSON.stringify(obj));
          document.getElementById('sbarStatus').textContent = 'Saved at ' + new Date().toLocaleString();
          toast('SBAR saved','primary');
        }
        function clearSBAR(){
          sbarS.value=sbarB.value=sbarA.value=sbarR.value='';
          document.getElementById('sbarStatus').textContent = 'Cleared';
        }
        function loadSBAR(){
          try {
            const obj = JSON.parse(localStorage.getItem('sc_sbar')||'null');
            if(obj){ sbarS.value=obj.S||''; sbarB.value=obj.B||''; sbarA.value=obj.A||''; sbarR.value=obj.R||''; document.getElementById('sbarStatus').textContent='Restored draft from '+ new Date(obj.at).toLocaleString(); }
          } catch {}
        }
        function readAloudSBAR(){
          const txt = `Situation: ${sbarS.value}. Background: ${sbarB.value}. Assessment: ${sbarA.value}. Recommendation: ${sbarR.value}.`;
          speak(txt);
        }
        loadSBAR();

        // ---------- Help ----------
        function showHelp(){
          alert(
`Shortcuts:
  / ‚Äî focus search
  Shift+N ‚Äî new note
  Shift+A ‚Äî add appointment

Tips:
 ‚Ä¢ Use Residents tab to filter & open profiles (demo data).
 ‚Ä¢ Tasks persist locally using your browser storage.
 ‚Ä¢ All actions here are prototype stubs ready to connect to Flask APIs.`);
        }
        function openNewNote(){
          const name = prompt('New note for which resident? (e.g., Jane Doe)');
          if(!name) return;
          toast('Note saved for '+name+' (demo)','secondary');
          logAudit('New note for '+name);
        }

        // Accessibility helper for screen readers (optional)
        function speak(text){ if(!('speechSynthesis' in window)) return; const u=new SpeechSynthesisUtterance(text); u.rate=.9; speechSynthesis.cancel(); speechSynthesis.speak(u); }
      </script>
    </main>
  </div>

  <!-- Resident Profile Modal -->
  <div class="modal fade" id="residentModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="residentTitle">Resident</h5>
          <button class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div id="residentBody"><!-- injected --></div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
          <button class="btn btn-primary" onclick="toast('Saved (demo)')">Save changes</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Add Appointment Modal -->
  <div class="modal fade" id="addApptModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Add appointment</h5>
          <button class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="mb-2">
            <label class="form-label">Resident</label>
            <select class="form-select" id="apptResident"></select>
          </div>
          <div class="mb-2">
            <label class="form-label">Type</label>
            <select class="form-select" id="apptType">
              <option>Checkup</option>
              <option>Cardiology</option>
              <option>Physiotherapy</option>
              <option>Lab</option>
            </select>
          </div>
          <div class="row g-2">
            <div class="col-7">
              <label class="form-label">Date</label>
              <input type="date" class="form-control" id="apptNewDate">
            </div>
            <div class="col-5">
              <label class="form-label">Time</label>
              <input type="time" class="form-control" id="apptNewTime" />
            </div>
          </div>
          <div class="mt-2">
            <label class="form-label">Notes</label>
            <textarea class="form-control" id="apptNotes" rows="2" placeholder="Prep instructions, escorts‚Ä¶"></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
          <button class="btn btn-primary" onclick="saveAppointment()">Save</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toasts -->
  <div class="toast-container" id="toastCtn"></div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // ---------- Mock Data ----------
    const RESIDENTS = [
      { id:'R101', name:'Jane Doe', room:'101A', status:'Stable', unit:'North-2', allergies:'Penicillin', last:'10:30', bp:'118/78', hr:72, temp:36.9, risks:['Allergy'], code:'Full', contact:'Daughter: 604-555-1234' },
      { id:'R102', name:'Robert White', room:'102B', status:'Needs Review', unit:'North-2', allergies:'NKDA', last:'09:50', bp:'140/90', hr:85, temp:37.5, risks:['Fall risk'], code:'DNR', contact:'Son: 604-555-5678' },
      { id:'R103', name:'Mary Lee', room:'103C', status:'Stable', unit:'East-1', allergies:'Latex', last:'11:00', bp:'125/82', hr:76, temp:37.0, risks:['Fall risk','Allergy'], code:'Full', contact:'Niece: 604-555-0000' },
    ];
    let APPOINTMENTS = [
      { id:'A1', resident:'Jane Doe', type:'PT', date:todayISO(), time:'10:30', status:'Scheduled' },
      { id:'A2', resident:'Robert White', type:'Cardiology', date:addDaysISO(1), time:'14:00', status:'Scheduled' },
      { id:'A3', resident:'Mary Lee', type:'Lab', date:addDaysISO(2), time:'09:15', status:'Scheduled' },
    ];

    // ---------- Utilities ----------
    function todayISO(){ const d = new Date(); d.setHours(0,0,0,0); return d.toISOString().split('T')[0]; }
    function addDaysISO(n){ const d = new Date(); d.setDate(d.getDate()+n); d.setHours(0,0,0,0); return d.toISOString().split('T')[0]; }
    function speak(text){ if('speechSynthesis' in window){ const u=new SpeechSynthesisUtterance(text); u.rate=.9; speechSynthesis.cancel(); speechSynthesis.speak(u);} }
    function toast(msg, variant='primary'){ const id='t'+Math.random().toString(36).slice(2); const el=document.createElement('div'); el.className=`toast align-items-center text-bg-${variant}`; el.id=id; el.setAttribute('role','status'); el.setAttribute('aria-live','polite'); el.innerHTML=`<div class="d-flex"><div class="toast-body">${msg}</div><button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button></div>`; document.getElementById('toastCtn').appendChild(el); new bootstrap.Toast(el,{delay:2500}).show(); }

    // ---------- Global Search ----------
    function focusGlobalSearch(){ document.getElementById('globalSearch').focus(); }
    document.addEventListener('keydown', (e)=> {
      if(e.key === '/' && !['INPUT','TEXTAREA'].includes(document.activeElement.tagName)){ e.preventDefault(); focusGlobalSearch(); }
      if(e.shiftKey && e.key.toLowerCase()==='n'){ e.preventDefault(); openNewNote(); }
      if(e.shiftKey && e.key.toLowerCase()==='a'){ e.preventDefault(); openAddAppt(); }
    });

    // ---------- Overview actions ----------
    function ackAlerts(){ toast('Alerts acknowledged', 'danger'); }

    // ---------- Residents: render & filter ----------
    function renderResidents(list=RESIDENTS){
      const tbody = document.querySelector('#resTable tbody');
      tbody.innerHTML = '';
      list.forEach(r=>{
        const badge = r.status==='Stable' ? '<span class="badge bg-success">Stable</span>'
                    : r.status==='Needs Review' ? '<span class="badge bg-warning text-dark">Needs Review</span>'
                    : '<span class="badge bg-danger">Critical</span>';
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td><strong>${r.name}</strong><div class="small text-muted">${r.id}</div></td>
          <td>${r.room}</td>
          <td>${badge}</td>
          <td>${r.allergies||'‚Äî'}</td>
          <td>${r.last}</td>
          <td class="text-end">
            <div class="btn-group">
              <button class="btn btn-sm btn-outline-primary" onclick="openResident('${r.id}')">View</button>
              <button class="btn btn-sm btn-outline-secondary" onclick="logAudit('Edited ${r.name} (demo)'); toast('Saved (demo)','secondary')">Save</button>
            </div>
          </td>`;
        tbody.appendChild(tr);
      });
    }
    function filterResidents(){
      const q = document.getElementById('resSearch').value.trim().toLowerCase();
      const s = document.getElementById('resStatus').value;
      const u = document.getElementById('resUnit').value;
      const filt = RESIDENTS.filter(r=>{
        const hit = (r.name.toLowerCase().includes(q) || r.room.toLowerCase().includes(q) || r.id.toLowerCase().includes(q));
        const statusOk = !s || r.status===s;
        const unitOk = !u || r.unit===u;
        return hit && statusOk && unitOk;
      });
      renderResidents(filt);
    }
    function openResident(id){
      const r = RESIDENTS.find(x=>x.id===id);
      if(!r) return;
      document.getElementById('residentTitle').textContent = `${r.name} ‚Äî ${r.room}`;
      document.getElementById('residentBody').innerHTML = `
        <div class="row g-3">
          <div class="col-md-6">
            <div class="section-card">
              <h6>Clinical snapshot</h6>
              <div>BP: <strong>${r.bp}</strong> ‚Ä¢ HR: <strong>${r.hr}</strong> ‚Ä¢ Temp: <strong>${r.temp}¬∞C</strong></div>
              <div>Risks: ${r.risks.map(x=>`<span class="chip ${x.toLowerCase().includes('fall')?'amber':'red'}">${x}</span>`).join(' ')}</div>
              <div>Allergies: <strong>${r.allergies||'‚Äî'}</strong></div>
              <div>Code status: <strong>${r.code}</strong></div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="section-card">
              <h6>Contacts</h6>
              <div>${r.contact}</div>
              <h6 class="mt-3">Notes</h6>
              <textarea class="form-control" rows="4" placeholder="Progress note‚Ä¶"></textarea>
            </div>
          </div>
          <div class="col-12">
            <div class="section-card">
              <h6>Appointments</h6>
              <ul class="mb-0">
                ${APPOINTMENTS.filter(a=>a.resident===r.name).map(a=>`<li>${a.date} ‚Ä¢ ${a.time} ‚Ä¢ ${a.type} <span class="chip green">${a.status}</span></li>`).join('')}
              </ul>
            </div>
          </div>
        </div>`;
      new bootstrap.Modal('#residentModal').show();
      logAudit(`Viewed ${r.name}`);
    }
    function logAudit(text){
      const li = document.createElement('li');
      li.textContent = `${new Date().toLocaleString()} ‚Äî ${text}`;
      document.getElementById('auditList').prepend(li);
    }

    // Initial render
    renderResidents();

    // ---------- Appointments ----------
    function renderAppts(){
      const view = document.getElementById('apptView').value;
      const date = document.getElementById('apptDate').value || todayISO();
      const list = document.getElementById('apptList');
      const base = new Date(date);
      let days = view==='day' ? 1 : 7;
      let html = '';
      for(let i=0;i<days;i++){
        const d = new Date(base); d.setDate(base.getDate()+i);
        const iso = d.toISOString().split('T')[0];
        const rows = APPOINTMENTS.filter(a=>a.date===iso).map(a=>`
          <tr>
            <td>${a.time}</td>
            <td><strong>${a.resident}</strong></td>
            <td>${a.type}</td>
            <td><span class="chip ${a.status==='Scheduled'?'green':'amber'}">${a.status}</span></td>
            <td class="text-end">
              <button class="btn btn-sm btn-outline-secondary" onclick="toast('Rescheduled (demo)')">Reschedule</button>
              <button class="btn btn-sm btn-outline-danger" onclick="toast('Cancelled (demo)','danger')">Cancel</button>
            </td>
          </tr>`).join('');
        html += `
          <div class="section-card">
            <h5 class="mb-2">${d.toLocaleDateString()}</h5>
            <div class="table-responsive">
              <table class="table table-sm align-middle">
                <thead><tr><th>Time</th><th>Resident</th><th>Type</th><th>Status</th><th></th></tr></thead>
                <tbody>${rows || '<tr><td colspan="5" class="text-muted">No appointments</td></tr>'}</tbody>
              </table>
            </div>
          </div>`;
      }
      list.innerHTML = html;
    }
    document.getElementById('apptDate').value = todayISO();
    document.getElementById('apptView').addEventListener('change', renderAppts);
    document.getElementById('apptDate').addEventListener('change', renderAppts);
    renderAppts();

    function openAddAppt(){
      // populate residents
      const sel = document.getElementById('apptResident');
      sel.innerHTML = RESIDENTS.map(r=>`<option>${r.name}</option>`).join('');
      document.getElementById('apptNewDate').value = todayISO();
      document.getElementById('apptNewTime').value = '09:00';
      document.getElementById('apptNotes').value = '';
      new bootstrap.Modal('#addApptModal').show();
    }
    function saveAppointment(){
      const resident = document.getElementById('apptResident').value;
      const type = document.getElementById('apptType').value;
      const date = document.getElementById('apptNewDate').value;
      const time = document.getElementById('apptNewTime').value;
      APPOINTMENTS.push({ id:'A'+(APPOINTMENTS.length+1), resident, type, date, time, status:'Scheduled' });
      renderAppts();
      toast('Appointment saved (demo)');
      bootstrap.Modal.getInstance(document.getElementById('addApptModal')).hide();
      logAudit(`Added appt for ${resident} (${type}) ${date} ${time}`);
    }
    function sendReminders(){ toast('Reminders sent (demo)','secondary'); }

    // ---------- Tasks & Rounds (localStorage) ----------
    const TASKS_KEY = 'sc_tasks';
    function getTasks(){ try { return JSON.parse(localStorage.getItem(TASKS_KEY)||'[]'); } catch { return []; } }
    function saveTasks(t){ localStorage.setItem(TASKS_KEY, JSON.stringify(t)); }
    function renderTasks(){
      const t = getTasks();
      const list = document.getElementById('taskList');
      if(!t.length){ list.innerHTML = '<div class="text-muted">No tasks yet. Click ‚ÄúÔºã New Task‚Äù.</div>'; return; }
      list.innerHTML = t.map((x,i)=>`
        <div class="form-check d-flex align-items-start gap-2 py-1">
          <input class="form-check-input mt-1" type="checkbox" ${x.done?'checked':''} onchange="toggleTask(${i})">
          <div class="w-100">
            <div><strong>${x.title}</strong> ‚Äî <span class="text-muted">${x.resident||'Unassigned'}</span></div>
            <div class="small text-muted">Due: ${x.due||'‚Äî'} ‚Ä¢ Assigned: ${x.assignee||'‚Äî'} ‚Ä¢ Priority: ${x.priority||'Normal'}</div>
          </div>
          <button class="btn btn-sm btn-outline-danger" onclick="deleteTask(${i})">Delete</button>
        </div>`).join('');
    }
    function addTaskPrompt(){
      const title = prompt('Task title (e.g., Wound dressing 101A)');
      if(!title) return;
      const resident = prompt('Resident (optional)');
      const due = prompt('Due time (e.g., 14:00 or 2025-10-13 14:00)');
      const assignee = prompt('Assign to (e.g., Tommy)');
      const priority = prompt('Priority (Low/Normal/High)','Normal');
      const t = getTasks();
      t.push({ title, resident, due, assignee, priority, done:false });
      saveTasks(t); renderTasks(); toast('Task added');
    }
    function toggleTask(i){ const t=getTasks(); t[i].done=!t[i].done; saveTasks(t); renderTasks(); }
    function deleteTask(i){ const t=getTasks(); t.splice(i,1); saveTasks(t); renderTasks(); }
    function completeSelected(){ const t=getTasks().map(x=>({...x,done:true})); saveTasks(t); renderTasks(); toast('All tasks marked done','success'); }
    function clearCompleted(){ const t=getTasks().filter(x=>!x.done); saveTasks(t); renderTasks(); }

    renderTasks();

    // ---------- Messaging ----------
    function sendMsg(){
      const input = document.getElementById('msgInput');
      const val = input.value.trim();
      if(!val) return;
      const div = document.createElement('div');
      div.className = 'msg me';
      div.innerHTML = `<strong>You:</strong> ${val}`;
      document.getElementById('msgThread').appendChild(div);
      input.value='';
    }

    // ---------- SBAR ----------
    function saveSBAR(){
      const obj = { S: sbarS.value, B: sbarB.value, A: sbarA.value, R: sbarR.value, at: new Date().toISOString() };
      localStorage.setItem('sc_sbar', JSON.stringify(obj));
      document.getElementById('sbarStatus').textContent = 'Saved at ' + new Date().toLocaleString();
      toast('SBAR saved','primary');
    }
    function clearSBAR(){
      sbarS.value=sbarB.value=sbarA.value=sbarR.value='';
      document.getElementById('sbarStatus').textContent = 'Cleared';
    }
    function loadSBAR(){
      try {
        const obj = JSON.parse(localStorage.getItem('sc_sbar')||'null');
        if(obj){ sbarS.value=obj.S||''; sbarB.value=obj.B||''; sbarA.value=obj.A||''; sbarR.value=obj.R||''; document.getElementById('sbarStatus').textContent='Restored draft from '+ new Date(obj.at).toLocaleString(); }
      } catch {}
    }
    function readAloudSBAR(){
      const txt = `Situation: ${sbarS.value}. Background: ${sbarB.value}. Assessment: ${sbarA.value}. Recommendation: ${sbarR.value}.`;
      speak(txt);
    }
    loadSBAR();

    // ---------- Help ----------
    function showHelp(){
      alert(
`Shortcuts:
  / ‚Äî focus search
  Shift+N ‚Äî new note
  Shift+A ‚Äî add appointment

Tips:
 ‚Ä¢ Use Residents tab to filter & open profiles (demo data).
 ‚Ä¢ Tasks persist locally using your browser storage.
 ‚Ä¢ All actions here are prototype stubs ready to connect to Flask APIs.`);
    }
    function openNewNote(){
      const name = prompt('New note for which resident? (e.g., Jane Doe)');
      if(!name) return;
      toast('Note saved for '+name+' (demo)','secondary');
      logAudit('New note for '+name);
    }

    // Accessibility helper for screen readers (optional)
    function speak(text){ if(!('speechSynthesis' in window)) return; const u=new SpeechSynthesisUtterance(text); u.rate=.9; speechSynthesis.cancel(); speechSynthesis.speak(u); }
  </script>
</body>
</html>
